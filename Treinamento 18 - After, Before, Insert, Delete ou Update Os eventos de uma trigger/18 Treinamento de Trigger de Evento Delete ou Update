
-- TREINAMENTO DE TRIGGER DE REGISTRO DE EVENTOS DE DELETE.


/* 01 CRIANDO O PRIMEIRO BANCO DE DADOS QUE RECEBERÁ OS REGISTROS*/

CREATE DATABASE LOJA;
USE LOJA;

/* CRIANDO A TABELA PRODUTO*/

CREATE TABLE PRODUTO(
	IDPRODUTO INT PRIMARY KEY AUTO_INCREMENT,
	NOME VARCHAR(30),
	VALOR FLOAT(10,2)

);







-- ESPAÇO RESERVADO PARA A CRIAÇÃO DAS TRIGGERS DE DELETE E EVENTO DA TRIGGER

DELIMITER $

CREATE TRIGGER BKP_DELETE_PRODUTO
BEFORE DELETE ON PRODUTO
FOR EACH ROW
BEGIN

	INSERT INTO BACKUP.BKP_PRODUTO VALUES
	(OLD.IDPRODUTO,OLD.NOME,OLD.VALOR,'D');

END 

$

DELIMITER ;




-- REALIZANDO AGORA OS TESTES DE INSERT E DELETE.

INSERT INTO PRODUTO VALUES (NULL,'LIVRO CSS',56.25);
INSERT INTO PRODUTO VALUES (NULL,'LIVRO SQL',64);
INSERT INTO PRODUTO VALUES (NULL,'LIVRO PYTHON',88);




-- REALIZANDO O DELETE
DELETE FROM PRODUTO WHERE IDPRODUTO =1;


/* 02 CRIANDO AGORA O SEGUNDO BANCO DE DADOS PARA FAZER A CÓPIA DOS DADOS DELETADO DO PRIMEIRO BANCO*/

CREATE DATABASE BACKUP;
USE BACKUP;

-- CONFORME O EVENDO DA TRIGGER VAMOS ADICIONAR O D(DELETE) NO EVENTO PARA SABERMOS O TIPO DO EVENTO

CREATE TABLE BKP_PRODUTO(
	IDBACKUP INT PRIMARY KEY AUTO_INCREMENT,
	IDPRODUTO INT,
	NOME VARCHAR(30),
	VALOR FLOAT(10,2)

);

ALTER TABLE BACKUP.BKP_PRODUTO
ADD EVENTO CHAR(1);

